<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Automation Rhapsody" href="https://automationrhapsody.com/rss.xml"><meta name="generator" content="Astro v5.5.3"><!-- Font preloads --><!-- <link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin /> --><!-- <link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin /> --><link rel="stylesheet" property="stylesheet" href="https://fonts.googleapis.com/css?family=Playball"><link rel="stylesheet" property="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:400,400italic,700"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"><!-- Canonical URL --><link rel="canonical" href="https://automationrhapsody.com/code-coverage-with-jacoco-offline-instrumentation-with-maven/"><!-- Primary Meta Tags --><title>Code coverage with JaCoCo offline instrumentation with Maven</title><meta name="title" content="Code coverage with JaCoCo offline instrumentation with Maven"><meta name="description" content="Tutorial how to do code coverage with offline instrumentation with JaCoCo and Maven."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://automationrhapsody.com/code-coverage-with-jacoco-offline-instrumentation-with-maven/"><meta property="og:title" content="Code coverage with JaCoCo offline instrumentation with Maven"><meta property="og:description" content="Tutorial how to do code coverage with offline instrumentation with JaCoCo and Maven."><meta property="og:image" content="https://automationrhapsody.com/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://automationrhapsody.com/code-coverage-with-jacoco-offline-instrumentation-with-maven/"><meta property="twitter:title" content="Code coverage with JaCoCo offline instrumentation with Maven"><meta property="twitter:description" content="Tutorial how to do code coverage with offline instrumentation with JaCoCo and Maven."><meta property="twitter:image" content="https://automationrhapsody.com/blog-placeholder-1.jpg"><style>:root{--color-gray-bg: #f5f5f5;--color-gray-text: #5e5e5e}body{font-family:Roboto,sans-serif;background:var(--color-gray-bg);word-wrap:break-word;overflow-wrap:break-word;color:var(--color-gray-text);font-size:18px}main{width:960px;max-width:calc(100% - 2em);margin:auto}h2{color:#3879d9;font-size:20px;margin:25px 0 6px}p{margin:6px 0}img{max-width:100%}@media (max-width: 720px){body{font-size:16px}ul{padding-inline-start:16px}}footer[data-astro-cid-sz7xmlte]{margin:24px 0;text-align:center}header[data-astro-cid-3ef6ksr2]{text-align:center;font-size:56px}header[data-astro-cid-3ef6ksr2] div[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{font-family:Playball,Arial;color:#000;text-decoration:none;text-shadow:0 .033em 0 #fff;border-bottom:none}
article[data-astro-cid-bvzihdzo]{padding:24px;box-shadow:0 2px 3px #acabab;background:#fff;position:relative}.post-title[data-astro-cid-bvzihdzo]{font-family:Bitter,serif;font-weight:700!important;margin:0;padding:5px 0;font-size:32px;line-height:40px;color:#444}@media (max-width: 720px){article[data-astro-cid-bvzihdzo]{padding:12px}}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <div data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2>Automation Rhapsody</a> </div> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2015-08-19T00:00:00.000Z"> Aug 19, 2015 </time> <div class="last-updated-on" data-astro-cid-bvzihdzo>
Last updated on <time datetime="2022-01-18T00:00:00.000Z"> Jan 18, 2022 </time> </div> </div> <h1 class="post-title" data-astro-cid-bvzihdzo>Code coverage with JaCoCo offline instrumentation with Maven</h1> <hr data-astro-cid-bvzihdzo> </div>  <h2>Offline instrumentation</h2>
<a href="/code-coverage-of-manual-or-automated-tests-with-jacoco/">Code coverage of manual or automated tests with JaCoCo</a> post describes how to do code coverage with JaCoCo. This is applicable in many of the cases. Still, there could be a case where the application under test does not support Java agents. In this case, JaCoCo offers offline instrumentation of the code. A once instrumented code can be run and coverage to be measured. This post describes how to do it.
<h2>JaCoCo for Maven</h2>
JaCoCo Maven plugin is discussed in <a href="/automated-code-coverage-of-unit-tests-with-jacoco-and-maven/">Automated code coverage of unit tests with JaCoCo and Maven</a> post. In order to get code instrumented "instrument" task should be added to Maven:
<pre class="language-xml"><code>&#x3C;properties>
	&#x3C;jacoco.skip.instrument>true&#x3C;/jacoco.skip.instrument>
&#x3C;/properties>
&#x3C;build>
	&#x3C;plugins>
		&#x3C;plugin>
			&#x3C;groupId>org.jacoco&#x3C;/groupId>
			&#x3C;artifactId>jacoco-maven-plugin&#x3C;/artifactId>
			&#x3C;version>0.7.4.201502262128&#x3C;/version>
			&#x3C;executions>
				&#x3C;execution>
					&#x3C;id>jacoco-instrument&#x3C;/id>
					&#x3C;phase>test&#x3C;/phase>
					&#x3C;goals>
						&#x3C;goal>instrument&#x3C;/goal>
					&#x3C;/goals>
					&#x3C;configuration>
						&#x3C;skip>${jacoco.skip.instrument}&#x3C;/skip>
					&#x3C;/configuration>
				&#x3C;/execution>
			&#x3C;/executions>
		&#x3C;/plugin>
	&#x3C;/plugins>
&#x3C;/build>
</code></pre>
In the current example, this task will be executed when <em><strong>mvn test</strong></em> is called. It can be configured to be called on <em><strong>package</strong></em> or <em><strong>install</strong></em> by changing the <em><strong>&#x3C;phase></strong></em> element.
<h2>Make it configurable</h2>
Instrumentation should not be done on every build. You do not want to release instrumented code, first because this is bad practice and second code will not run unless <em><strong>jacocoagent.jar</strong></em> is in the classpath. This is why instrumentation should be disabled by default with <em><strong>jacoco.skip.instrument=true</strong></em> in <em><strong>pom.xml</strong></em> property, which can be overridden when needed with <em><strong>mvn clean test -Djacoco.skip.instrument=false</strong></em> command. Another option is separate <em><strong>pom-offline.xml</strong></em> file and build with it when needed.
<h2>Get sample application</h2>
Current post uses sample application first introduced in <a href="/rest-performance-problems-with-dropwizard-and-jersey-jaxb-provider/" target="_blank" rel="noopener noreferrer">Build a RESTful stub server with Dropwizard</a> post. It can be found in GitHub <a title="sample-dropwizard-rest-stub" href="https://github.com/llatinov/sample-dropwizard-rest-stub" target="_blank" rel="noopener noreferrer">sample-dropwizard-rest-stub</a> repository. For the current tutorial, it has been downloaded to <em><strong>C:\sample-dropwizard-rest-stub</strong></em>. This application gets packaged to a single JAR file by <em><strong>mvn clean package</strong></em>. If instrumentation gets put in <em><strong>package</strong></em> phase then it is not working, as packaging happens before instrumentation. This is why <em><strong>test</strong></em> phase is the correct for the current example, as <em><strong>package</strong></em> includes <em><strong>test</strong></em> by default.
<h2>Instrument the code</h2>
Once the application is downloaded it can be built with instrumentation with <em><strong>mvn clean package -Djacoco.skip.instrument=false</strong></em> command. You can easily check if given class has been instrumented by opening it with some kind of decompiler. The image below shows instrumented class on the right hand side vs non-instrumented in the left hand side.
<p><a href="/images/2015/08/JaCoCo-offline.png"><img src="/images/2015/08/JaCoCo-offline.png" alt="JaCoCo-offline"></a></p>
<h2>Run it with JaCoCo agent in the class path</h2>
If not instrumented sample application is started with: <em><strong>java -jar target/sample-dropwizard-rest-stub-1.0-SNAPSHOT.jar server config.yml</strong></em>. In case of instrumented code this command will give exception:
<p><strong>Exception in thread “main” java.lang.NoClassDefFoundError: org/jacoco/agent/rt/internal_773e439/Offline</strong></p>
<p>This is because jacocoagent.jar is not in the classpath.</p>
<p>Adding JaCoCo agent in class path varies from case to case. In this particular tutorial application is a single JAR run by <em><strong>java -jar</strong></em> command. In order to add something in classpath <em><strong>java -cp</strong></em> command should be used. Problem is both <em><strong>-jar</strong></em> and <em><strong>-cp</strong></em> are mutually exclusive. Only way to do it is with the following command:</p>
<p><strong>java -Djacoco-agent.output=tcpserver -cp C:\JaCoCo\jacocoagent.jar;target/sample-dropwizard-rest-stub-1.0-SNAPSHOT.jar com.automationrhapsody.reststub.RestStubApp server config.yml</strong></p>
<p>Where <em><strong>-Djacoco-agent.output=tcpserver</strong></em> is configuration to make JaCoCo agent report on TCP port. More about <a href="https://www.eclemma.org/jacoco/trunk/doc/offline.html" target="_blank" rel="noopener noreferrer">JaCoCo Offline settings</a> here. <em><strong>C:\JaCoCo\jacocoagent.jar</strong></em> is the location of the JaCoCo agent JAR file. <em><strong>com.automationrhapsody.reststub.RestStubApp</strong></em> is the main method to be run from <em><strong>target/sample-dropwizard-rest-stub-1.0-SNAPSHOT.jar</strong></em> file.</p>
<h2>Test</h2>
Now when we have the application running is time to run all tests we have both automation and manual. For manual, it is important to be documented scenario which is reproducible on each regression testing, not just some random clicking. The idea is that we want to measure what coverage our tests do.
<h2>Import coverage results</h2>
In order to import results Eclipse with installed JaCoCo plugin from market place is needed. See <a href="/code-coverage-of-manual-or-automated-tests-with-jacoco/">Code coverage of manual or automated tests with JaCoCo</a> post for more details how to install the plugin.
<p>Open Eclipse and import C:\sample-dropwizard-rest-stub project as Maven one.</p>
<p>Import the results into Eclipse. This is done from <em><strong>File -> Import -> Coverage Session -> select Agent address radio button but leave defaults -> enter some name and select code under test</strong></em>.</p>
<p><a href="/images/2015/08/JaCoCo-import.png"><img src="/images/2015/08/JaCoCo-import.png" alt="JaCoCo-import"></a></p>
<p>Once imported results can be seen and code gets highlighted.</p>
<p>In case no results are imported delete <em><strong>target\classes</strong></em> folder and rebuild with <em><strong>mvn compile</strong></em>.</p>
<h2>Export to HTML and analyze</h2>
See <a href="/code-coverage-of-manual-or-automated-tests-with-jacoco/">Code coverage of manual or automated tests with JaCoCo</a> how to export and analyze.
<h2>Conclusion</h2>
Although very rare to happen offline instrumentation is a way to measure code coverage with JaCoCo.  </div> </article> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2025 - Automation Rhapsody. All rights reserved.
</footer>  </body></html>