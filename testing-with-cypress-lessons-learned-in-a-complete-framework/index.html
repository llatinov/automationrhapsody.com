<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Automation Rhapsody" href="https://automationrhapsody.com/rss.xml"><meta name="generator" content="Astro v5.5.3"><script src="/scripts.js"></script><!-- Font preloads --><link rel="stylesheet" property="stylesheet" href="https://fonts.googleapis.com/css?family=Playball"><link rel="stylesheet" property="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:400,400italic,700"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"><!-- Canonical URL --><link rel="canonical" href="https://automationrhapsody.com/testing-with-cypress-lessons-learned-in-a-complete-framework/"><!-- Primary Meta Tags --><title>Testing with Cypress - lessons learned in a complete framework</title><meta name="title" content="Testing with Cypress - lessons learned in a complete framework"><meta name="description" content="In the current post I will share some lessons I've learned using Cypress for quite a long time. Along this journey, I created a framework which solves some of the pain points that Cypress has."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://automationrhapsody.com/testing-with-cypress-lessons-learned-in-a-complete-framework/"><meta property="og:title" content="Testing with Cypress - lessons learned in a complete framework"><meta property="og:description" content="In the current post I will share some lessons I've learned using Cypress for quite a long time. Along this journey, I created a framework which solves some of the pain points that Cypress has."><meta property="og:image" content="https://automationrhapsody.com/blog-placeholder.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://automationrhapsody.com/testing-with-cypress-lessons-learned-in-a-complete-framework/"><meta property="twitter:title" content="Testing with Cypress - lessons learned in a complete framework"><meta property="twitter:description" content="In the current post I will share some lessons I've learned using Cypress for quite a long time. Along this journey, I created a framework which solves some of the pain points that Cypress has."><meta property="twitter:image" content="https://automationrhapsody.com/blog-placeholder.jpg"><style>:root{--color-gray-bg: #f5f5f5;--color-gray-text: #5e5e5e}body{font-family:Roboto,sans-serif;background:var(--color-gray-bg);word-wrap:break-word;overflow-wrap:break-word;color:var(--color-gray-text);font-size:18px}main{width:960px;max-width:calc(100% - 2em);margin:auto}h2{color:#3879d9;font-size:20px;margin:25px 0 6px}p{margin:6px 0}img{max-width:100%}pre{margin:0;padding:12px}@media (max-width: 720px){body{font-size:16px}ul{padding-inline-start:16px}}.tab{overflow:hidden;border:1px solid #ccc;background-color:#f1f1f1}.tab button{background-color:inherit;float:left;border:none;outline:none;cursor:pointer;padding:14px 16px;transition:.3s}.tab button:hover{background-color:#ddd}.tab button.active{background-color:#ccc}.tabcontent{display:none;border-top:none}footer[data-astro-cid-sz7xmlte]{margin:24px 0;text-align:center}header[data-astro-cid-3ef6ksr2]{text-align:center;font-size:56px}header[data-astro-cid-3ef6ksr2] div[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{font-family:Playball,Arial;color:#000;text-decoration:none;text-shadow:0 .033em 0 #fff;border-bottom:none}
article[data-astro-cid-bvzihdzo]{padding:24px;box-shadow:0 2px 3px #acabab;background:#fff;position:relative}.post-title[data-astro-cid-bvzihdzo]{font-family:Bitter,serif;font-weight:700!important;margin:0;padding:5px 0;font-size:32px;line-height:40px;color:#444}.tags[data-astro-cid-bvzihdzo]{display:flex;flex-wrap:wrap}.tags[data-astro-cid-bvzihdzo]>a[data-astro-cid-bvzihdzo]{margin-left:8px}@media (max-width: 720px){article[data-astro-cid-bvzihdzo]{padding:12px}}
</style></head> <body data-astro-cid-bvzihdzo> <header data-astro-cid-3ef6ksr2> <div data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2>Automation Rhapsody</a> </div> </header>  <main data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo> <div class="prose" data-astro-cid-bvzihdzo> <div class="title" data-astro-cid-bvzihdzo> <h1 class="post-title" data-astro-cid-bvzihdzo>Testing with Cypress - lessons learned in a complete framework</h1> <div class="date" data-astro-cid-bvzihdzo> <time datetime="2019-06-27T00:00:00.000Z"> Jun 27, 2019 </time> </div> <hr data-astro-cid-bvzihdzo> </div>  <h2>Introduction</h2>
More than a year ago I made a bold presentation about Cypress. Back then I had been using Cypress on a small and very nice React application, and I was fascinated by the tool. You can read the presentation content in <a href="/cypress-vs-selenium-end-era/">Cypress vs. Selenium, is this the end of an era?</a> post.  Now more than a year later and 10K lines of test code I am still fascinated by Cypress and also I have discovered several things that were causing me pain during my work. In the current post, I will try to write for some of them, some of them I truly had forgotten. In the course of using Cypress, I had decided to change things I do not like and make them in the way I really enjoy it. The result of this is a framework, maybe this is too overrated, more likely a set of helper files which you can pick and directly use in your project. The code is located in <a href="https://github.com/llatinov/cypress-testing-framework" target="_blank" rel="noopener noreferrer">cypress-testing-framework</a> GitHub repository.
<h2>Post in the series</h2>
This is the first of series of posts dedicated to testing with Cypress and making your tests easier to write. All posts from the series are:
<ul>
 	<li><a href="/testing-with-cypress-build-a-react-application-with-node-js-backend/">Testing with Cypress - Build a React application with Node.js backend</a></li>
 	<li><a href="/testing-with-cypress-basic-api-overview/">Testing with Cypress - Basic API overview</a></li>
 	<li><a href="/testing-with-cypress-custom-logging-of-errors-and-junit-results/">Testing with Cypress - Custom logging of errors and JUnit results</a></li>
 	<li><a href="/testing-with-cypress-code-coverage-with-istanbul/">Testing with Cypress - Code coverage with Istanbul</a></li>
</ul>
<h2>Application under test</h2>
In order to demonstrate some of the features, I have built a very simple React application. It has a backend that manipulates the data and the React application is consuming the backend APIs. More about the application itself can be found in <a href="/testing-with-cypress-build-a-react-application-with-node-js-backend/">Testing with Cypress - Build a React application with Node.js backend</a> post.
<h2>Cypress API</h2>
Cypress has a rich API, offering lots of functionality. So far many of us are very used to Selenium, and it is a little surprise when you first deal with Cypress. There is some ramp-up time needed. Once you get acknowledged, things start to happen pretty fast and easy. Read more about the API along with some examples <a href="/testing-with-cypress-basic-api-overview/">Testing with Cypress - Basic API overview</a> post.
<h2>Page Object Model</h2>
Cypress does not recommend using POM but prefers using <a href="https://docs.cypress.io/api/cypress-api/custom-commands.html" target="_blank" rel="noopener noreferrer">Cypress custom commands</a> instead. See а very good and justified post on the topic, named <a href="https://www.cypress.io/blog/2019/01/03/stop-using-page-objects-and-start-using-app-actions/" target="_blank" rel="noopener noreferrer">Stop using Page Objects and Start using App Actions</a>. Although the justification seems very logical, I do not agree with that approach. I still use custom commands, but not as a replacement of page objects, I am not giving up the Page Object Model. It gives me more focus, while with custom commands you can easily start duplicate functionality. Check an example of a Page Object Model I am comfortable with in <a href="/testing-with-cypress-basic-api-overview/">Testing with Cypress - Basic API overview</a> post.
<h2>Test Runner going out of memory</h2>
This is my biggest pain. I have tried a lot to overcome this but I could not find any solution. It happens in case of a long test suite with lots of actions in it. Cypress keeps a <em><strong>before/after</strong></em> version of the page on every action, memory drains pretty fast and the browser crashes with <a href="https://github.com/cypress-io/cypress/issues/2459" target="_blank" rel="noopener noreferrer">Aw snap</a> error.
<p>The most recommended option is to use <em><strong>numTestsKeptInMemory</strong></em> to reduce the memory footprint, but then you need it to be at least one, so you can debug and inspect data into the console.</p>
<p>I also tried to pass <span><em><strong>—max-old-space-size</strong></em> to Node process. If you pass it to Cypress directly it crashes, so what I did was to rename the node executable to <em><strong>node_exec</strong></em>, and then create a new file named <em><strong>node</strong></em> in which I put <strong><em>node_exec</em> —max-old-space-size $@</strong> to forward all arguments to node executable. This did not help either. </span></p>
<p>Finally, I settled with the option to have custom commands to locate elements, which suppress more of the logging with <em><strong>{log: false}</strong></em>. Before/after version of locating the element is not needed, a snapshot is needed after a click or other significant action. Note that this <em><strong>log: false</strong></em> gave me a hard time when using <em><strong>cy.get</strong></em> because it was resetting the default timeout, so I had to pass the <em><strong>timeout</strong></em> as an option as well.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Cypress.Commands.add('getSilent', locator =></span></span>
<span class="line"><span>  cy.get(locator, {</span></span>
<span class="line"><span>    log: false,</span></span>
<span class="line"><span>    timeout: Cypress.config('defaultCommandTimeout'),</span></span>
<span class="line"><span>  }),</span></span>
<span class="line"><span>);</span></span>
<span class="line"><span></span></span></code></pre>
<p>This workaround did not solve the out of memory issue either, just allowed me to have a longer scenario before the Test Runner crashes.</p>
<p>On the other hand, this limitation is kind of a motivation for you to plan better, make more focused and short test suites.</p>
<h2>Cypress error logging and JUnit results</h2>
Cypress does not provide very good logging, the stack trace is practically useless, as your code is wrapped into Cypress' code. In order to work around this, I use some custom code which collects Cypress commands and then when a test fails it dumps the commands to a custom log file and a screenshot. The same code also creates custom JUnit test result files and it inserts the errors collected. Custom files are saved into <em><strong>cypress/logs</strong></em> folder of the project. You can read more about this custom logging in <a href="/testing-with-cypress-custom-logging-of-errors-and-junit-results/">Testing with Cypress - Custom logging of errors and JUnit results</a> post.
<h2>Rerun failed tests</h2>
Although Cypress is very stable, it still happens that some tests fail from time to time. I have added a task to rerun failed tests. This is done with <em><strong>yarn cypress:retry</strong></em>. This task iterates all custom created JUnit XMLs described in the previous section and makes a list of all tests that had failed. This list is saved into a file named <em><strong>retry-output.txt</strong></em> in <em><strong>cypress/logs</strong></em> folder. Those files are run again. The internal command that is called by retry code is <em><strong>yarn cypress:run --spec='cypress/tests/TestSuite.js'</strong></em>. The same command you can use manually to run a single test suite or more using an asterisk as a wildcard.
<h2>Code coverage</h2>
Code coverage is not mandatory, more likely a nice to have a metric, we try to monitor and improve on. Read more about code coverage in <a href="/what-about-code-coverage/">What about code coverage</a> post. For capturing code coverage <a href="https://istanbul.js.org/" target="_blank" rel="noopener noreferrer">Istanbul</a> is used. Code coverage is described in more details in <a href="/testing-with-cypress-code-coverage-with-istanbul/">Testing with Cypress - Code coverage with Istanbul</a> post.
<h2>Generate reports</h2>
An HTML report is generated in the end, it is invoked with <em><strong>yarn cypress:report</strong></em> command. This command relies on custom JUnit XMLs generated during the test run. You can read more details in <a href="/testing-with-cypress-custom-logging-of-errors-and-junit-results/">Testing with Cypress - Custom logging of errors and JUnit results</a> post.
<h2>Running tests in parallel</h2>
Cypress supports running tests in parallel. This is done with <em><strong>--parallel</strong></em> option when you run your tests. In order to do so, you need a subscription to Cypress Dashboard. There are various subscription plans, which are quite affordable. The idea is that Cypress records all your test runs and based on the timing and the available machines, it distributes evenly the tests across your machines. You can read more in <a href="https://docs.cypress.io/guides/guides/parallelization.html#Overview" target="_blank" rel="noopener noreferrer">Cypress Parallelization</a> article. I have not tried that and also I do not know how it is going to work with current customizations I am doing in the current post.
<p>Another option is to do the parallelism on your own. For this purpose, <a href="http://man7.org/linux/man-pages/man1/xargs.1.html" target="_blank" rel="noopener noreferrer">xargs Linux command</a> can be used. The command that you run under Linux is:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>find ./cypress/tests -name "*_spec.js" | xargs -n1 -P4 bash -c 'yarn cypress:run --spec="$@"' --</span></span>
<span class="line"><span></span></span></code></pre>
<p>Where the <em><strong>P4</strong></em> is the number you threads you want to have. The command finds all files ending with <em><strong>_spec.js</strong></em> with each if it, it invokes Cypress with a given number of simultaneous threads. Note that this parallelization is not very stable in case of Docker container. Randomly there are issues with <a href="https://en.wikipedia.org/wiki/Xvfb" target="_blank" rel="noopener noreferrer">Xvfb</a> frame buffer.</p>
<p>What worked for me is to have a <em><strong>docker-compose-yml</strong></em> file with several Cypress services. Each one of them is running a group of the tests, which I manually split. All services share the same volume so results are kept in one place. After those services finish, then another service is run which retries failed tests and aggregates the results and the code coverage. This service is sharing the same volume so it has access to all the test results.</p>
<h2>End to end process</h2>
To put the bits together. The process suggested in the current post consists of the following steps:
<ul>
 	<li><em><strong>yarn cypress:run</strong></em> - run the tests. During the run JUnit XML files are generated. In order to speed up tests can be run in parallel as well. Set <em><strong>TEST_CODE_COVERAGE=true</strong></em> is code coverage is needed.</li>
 	<li><strong><em>yarn</em> cypress:retry</strong> - retry failed tests, based on the JUnit XMLs generated from the previous step. You can retry twice if you need to.</li>
 	<li><strong><em>yarn</em> cypress:report</strong> - generate code coverage report, HTML report with results and also semaphore file that indicates if the tests passed or not.</li>
</ul>
<h2>Conclusion</h2>
Cypress is a great tool, I strongly recommend it. It is very stable and reliable. With the improvements, you can find with this series of posts, you can make automation with Cypress even more effective, reliable and enjoyable. Very good article with useful Cypress tips is Bahmutov's <a href="https://glebbahmutov.com/blog/cypress-tips-and-tricks/" target="_blank" rel="noopener noreferrer">Cypress tips and tricks</a>, I suggest you read it as well.  <hr data-astro-cid-bvzihdzo>  <h2 data-astro-cid-bvzihdzo>Related Posts</h2> <ul data-astro-cid-bvzihdzo> <li data-astro-cid-bvzihdzo> <a href="/cypress-vs-selenium-end-era/" data-astro-cid-bvzihdzo>Cypress vs. Selenium, is this the end of an era?</a> </li><li data-astro-cid-bvzihdzo> <a href="/testing-with-cypress-build-a-react-application-with-node-js-backend/" data-astro-cid-bvzihdzo>Testing with Cypress - Build a React application with Node.js backend</a> </li><li data-astro-cid-bvzihdzo> <a href="/testing-with-cypress-basic-api-overview/" data-astro-cid-bvzihdzo>Testing with Cypress - Basic API overview</a> </li><li data-astro-cid-bvzihdzo> <a href="/testing-with-cypress-custom-logging-of-errors-and-junit-results/" data-astro-cid-bvzihdzo>Testing with Cypress - Custom logging of errors and JUnit results</a> </li><li data-astro-cid-bvzihdzo> <a href="/testing-with-cypress-code-coverage-with-istanbul/" data-astro-cid-bvzihdzo>Testing with Cypress - Code coverage with Istanbul</a> </li><li data-astro-cid-bvzihdzo> <a href="/distributed-system-observability-instrument-cypress-tests-with-opentelemetry/" data-astro-cid-bvzihdzo>Distributed system observability: Instrument Cypress tests with OpenTelemetry</a> </li> </ul>  <div class="tags" data-astro-cid-bvzihdzo> <div data-astro-cid-bvzihdzo>Tags:</div> <a href="/tags/cypress" data-astro-cid-bvzihdzo>Cypress</a><a href="/tags/javascript" data-astro-cid-bvzihdzo>JavaScript</a><a href="/tags/tutorials" data-astro-cid-bvzihdzo>Tutorials</a><a href="/tags/web-automation" data-astro-cid-bvzihdzo>Web Automation</a> </div> </div> </article> </main> <footer data-astro-cid-sz7xmlte>
&copy; 2025 - Automation Rhapsody. All rights reserved.
</footer>  </body></html>